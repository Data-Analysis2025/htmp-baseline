# Hull Tactical Market Prediction - コンペティション概要

## 概要

Hull Tactical Market Predictionは、S&P 500の超過リターンを予測し、ボラティリティ制約の下でベンチマークをアウトパフォームすることを目的としたKaggleコンペティションです。このコンペティションは、効率的市場仮説（Efficient Market Hypothesis, EMH）に挑戦し、機械学習を用いた市場タイミング戦略の有効性を検証します。

## コンペティションの背景

### 効率的市場仮説への挑戦

従来の金融理論では、以下のような前提がありました：

- **効率的市場仮説（EMH）**: すべての入手可能な情報はすでに価格に織り込まれており、市場をアウトパフォームすることは不可能
- **インデックス投資の優位性**: プロの投資家でさえS&P 500に勝てないため、インデックスファンドへの投資が最適

しかし、機械学習とデータサイエンスの発展により、以下の問いが提起されています：

> **機械学習の時代において、市場のタイミングを計らないことこそが無責任なのではないか？**

このコンペティションは、十分な特徴量、機械学習、創造性を組み合わせることで、理論上は存在しないはずの持続可能なエッジ（優位性）を発見できるかを検証します。

## タスク

### 予測目標

- **メインタスク**: 日次のS&P 500超過リターンを予測
- **戦略決定**: 各取引日の終値時点で、S&P 500への資金配分比率を決定
- **配分範囲**: 0.0～2.0（一部レバレッジが許可される）

### 制約条件

- **ボラティリティ制約**: 戦略のボラティリティは市場の120%以内に抑える必要がある
- **リアルタイム制約**: 各予測は5分以内に返答する必要がある（初回のみ15分）
- **前向き検証**: 過去のデータを使用して未来を予測してはならない（no look-ahead bias）

## 評価指標

コンペティションの評価指標は **Modified Sharpe Ratio** です。この指標は以下をペナルティとして課します：

1. **過度なボラティリティ**: 市場よりも大幅に高いリスクを取る戦略
2. **低リターン**: 市場のリターンをアウトパフォームできない戦略

評価指標の詳細な実装は[こちら](https://www.kaggle.com/competitions/hull-tactical-market-prediction/overview/evaluation)で確認できます。

## データセット

### ファイル構成

#### train.csv

数十年分の歴史的市場データ。古いデータには広範な欠損値が含まれます。

**カラム構成**:

- `date_id`: 取引日の識別子
- **特徴量カテゴリ**:
  - `M*` - Market Dynamics/Technical features（市場動態・テクニカル指標）
  - `E*` - Macro Economic features（マクロ経済指標）
  - `I*` - Interest Rate features（金利関連）
  - `P*` - Price/Valuation features（価格・バリュエーション）
  - `V*` - Volatility features（ボラティリティ指標）
  - `S*` - Sentiment features（センチメント指標）
  - `MOM*` - Momentum features（モメンタム指標）
  - `D*` - Dummy/Binary features（ダミー・バイナリ変数）
- **ターゲット変数（訓練データのみ）**:
  - `forward_returns`: S&P 500を購入して1日後に売却した場合のリターン
  - `risk_free_rate`: 連邦準備制度の基準金利
  - `market_forward_excess_returns`: 5年移動平均を差し引き、中央絶対偏差（MAD）基準4でwinsorizeした超過リターン

#### test.csv

未来の取引日のデータ。公開リーダーボードでは訓練データの最後180日分のコピーが使用されます（そのため公開リーダーボードのスコアは意味を持ちません）。

**カラム構成**:

- `date_id`: 取引日の識別子
- **特徴量カラム**: train.csvと同じ
- `is_scored`: この行が評価指標の計算に含まれるかどうか
- **ラグ付きターゲット変数**（1日遅れで提供）:
  - `lagged_forward_returns`
  - `lagged_risk_free_rate`
  - `lagged_market_forward_excess_returns`

#### kaggle_evaluation/

Kaggle評価API用のファイル。デモノートブックでAPIの使用方法を確認できます。

### データの特徴

1. **時系列データ**: 日次の市場データで、時間的な依存関係が強い
2. **欠損値**: 古いデータほど特徴量が欠損している（データ収集インフラの発展による）
3. **高次元**: 多数の特徴量が含まれる
4. **非線形**: 市場は複雑で非線形な適応システム

## コンペティションフェーズ

### フェーズ1: モデル訓練フェーズ

- **テストセット**: 過去6ヶ月分の履歴データ
- **注意**: これらの価格は公開されているため、このフェーズのリーダーボードスコアは意味を持たない

### フェーズ2: 予測フェーズ

- **テストセット**: 提出締切後に収集されるデータ
- **期間**: フェーズ1と同程度（約6ヶ月）
- **スコアリング**: このフェーズのデータのみが最終評価に使用される

評価API中、テストデータは公開セットの開始から非公開セットの終了まで順次提供されます。提出締切前の取引日はスコアリングされません。

## 提出形式

このコンペティションでは、**評価API**を使用した提出が必須です。

### 評価APIの仕組み

1. **サーバー設定**: 推論リクエストに応答するサーバーを設定
2. **predict関数の実装**: 各取引日ごとに呼び出される関数を実装
3. **リアルタイム予測**: 時系列順にデータが提供され、forward-lookingを防止

### 実装要件

```python
def predict(test: pl.DataFrame) -> float:
    """
    各取引日のS&P 500への配分比率を返す

    Args:
        test: Polars DataFrame（当日の特徴量データ）

    Returns:
        float: 配分比率（0.0～2.0の範囲）

    制約:
        - 各バッチの予測は5分以内に完了する必要がある
        - 初回の予測は15分以内に完了する必要がある
    """
    # 実装
    return allocation
```

詳細な実装例は[デモノートブック](https://www.kaggle.com/code/...)を参照してください。

## 戦略のヒント

### 特徴量エンジニアリング

- **時系列特徴**: ローリング統計（移動平均、標準偏差）
- **ラグ特徴**: 過去N日分の特徴量
- **モメンタム指標**: 価格の勢い、変化率
- **ボラティリティ指標**: 標準偏差、ATR
- **マクロ経済指標**: 金利、経済成長率との関係

### モデル選択

- **線形モデル**: Ridge回帰、LASSO（解釈性が高い）
- **勾配ブースティング**: LightGBM、XGBoost（非線形関係の捕捉）
- **時系列モデル**: LSTM、GRU、Transformer（時間的依存関係のモデリング）
- **アンサンブル**: 複数モデルの組み合わせでロバスト性向上

### クロスバリデーション

- **TimeSeriesSplit**: 時系列データの特性を考慮した分割方法を使用
- **バックテスト**: 過去の複数期間でモデルの安定性を検証
- **ウォークフォワード分析**: 定期的にモデルを再学習して性能を維持

### リスク管理

- **ポジションサイジング**: 予測の確信度に応じた配分比率の調整
- **ボラティリティ管理**: 120%制約を考慮した動的な配分
- **ドローダウン制御**: 連続損失時の配分削減

## 実世界への応用

このコンペティションは単なる理論的演習ではありません：

- **実践的価値**: 構築したモデルは実際の投資戦略に応用可能
- **学術的意義**: 効率的市場仮説の検証に貢献
- **投資家への影響**: より良い、よりアクセスしやすい投資ツールの開発

成功すれば、以下を実証することになります：

1. **市場は完全には効率的ではない**
2. **データサイエンスは持続可能なエッジを生み出せる**
3. **現代ファイナンスの基本原理に再考を促す**

## 倫理的配慮

- **フェアな予測**: look-ahead biasを避け、実取引可能な戦略を構築
- **透明性**: モデルの意思決定プロセスを理解し説明可能にする
- **リスク開示**: モデルの限界とリスクを認識し、適切に管理する

## 参考資料

### 関連論文

- Fama, E. F. (1970). "Efficient Capital Markets: A Review of Theory and Empirical Work"
- Lo, A. W. (2004). "The Adaptive Markets Hypothesis"
- Harvey, C. R., Liu, Y., & Zhu, H. (2016). "… and the Cross-Section of Expected Returns"

### 推奨読書

- "A Random Walk Down Wall Street" by Burton Malkiel
- "The Little Book That Beats the Market" by Joel Greenblatt
- "Advances in Financial Machine Learning" by Marcos López de Prado

### オンラインリソース

- [Kaggleコンペページ](https://www.kaggle.com/competitions/hull-tactical-market-prediction)
- [Hull Tactical公式サイト](https://hulltactical.com/)
- [Quantopian/Alphalens](https://github.com/quantopian/alphalens) - 予測因子分析ツール

## コンペティション情報

- **主催**: Hull Tactical Asset Allocation, LLC
- **賞金**: TBD
- **開始日**: 1ヶ月前
- **終了日**: 2ヶ月後
- **参加条件**: Kaggleアカウントが必要

---

**Good luck and may your Sharpe ratio be ever in your favor!**
